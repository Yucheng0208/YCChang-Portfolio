<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAML Debug Tool</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
        }
        .debug-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .debug-title {
            color: #64d2ff;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #238636; color: white; }
        .error { background: #da3633; color: white; }
        .warning { background: #bf8700; color: white; }
        .info { background: #1f6feb; color: white; }
        pre {
            background: #0d1117;
            border: 1px solid #30363d;
            padding: 15px;
            border-radius: 6px;
            overflow: auto;
            white-space: pre-wrap;
        }
        button {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2ea043;
        }
        input[type="text"] {
            background: #0d1117;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 8px 12px;
            border-radius: 6px;
            width: 300px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” YAML Debug Tool</h1>
    
    <div class="debug-section">
        <div class="debug-title">ğŸ“ æª”æ¡ˆè·¯å¾‘æ¸¬è©¦</div>
        <input type="text" id="yamlPath" value="data/yaml/organizations.yaml" placeholder="YAML æª”æ¡ˆè·¯å¾‘">
        <button onclick="testFilePath()">æ¸¬è©¦è·¯å¾‘</button>
        <div id="pathResult"></div>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ“š js-yaml åº«æª¢æŸ¥</div>
        <div id="jsyamlStatus"></div>
        <button onclick="checkJsYaml()">æª¢æŸ¥ js-yaml</button>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸŒ ç¶²è·¯è«‹æ±‚æ¸¬è©¦</div>
        <div id="networkResult"></div>
        <button onclick="testNetworkRequest()">æ¸¬è©¦ç¶²è·¯è«‹æ±‚</button>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ“„ YAML å…§å®¹é è¦½</div>
        <div id="yamlPreview"></div>
        <button onclick="loadAndShowYaml()">è¼‰å…¥ä¸¦é¡¯ç¤º YAML</button>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ§ª YAML è§£ææ¸¬è©¦</div>
        <div id="parseResult"></div>
        <button onclick="testYamlParsing()">æ¸¬è©¦è§£æ</button>
    </div>

    <div class="debug-section">
        <div class="debug-title">ğŸ—ï¸ å»ºè­°çš„ä¿®å¾©æ–¹æ¡ˆ</div>
        <div id="suggestions"></div>
    </div>

    <script src="js/js-yaml.min.js"></script>
    <script>
        let yamlContent = '';
        
        // æª¢æŸ¥ js-yaml åº«
        function checkJsYaml() {
            const statusDiv = document.getElementById('jsyamlStatus');
            if (typeof jsyaml !== 'undefined') {
                statusDiv.innerHTML = `
                    <span class="status success">âœ… js-yaml åº«è¼‰å…¥æˆåŠŸ</span>
                    <pre>ç‰ˆæœ¬: ${jsyaml.VERSION || 'Unknown'}
å¯ç”¨æ–¹æ³•: ${Object.keys(jsyaml).join(', ')}</pre>
                `;
            } else {
                statusDiv.innerHTML = `
                    <span class="status error">âŒ js-yaml åº«æœªè¼‰å…¥</span>
                    <pre>è«‹æª¢æŸ¥ js/js-yaml.min.js æª”æ¡ˆæ˜¯å¦å­˜åœ¨</pre>
                `;
            }
        }

        // æ¸¬è©¦æª”æ¡ˆè·¯å¾‘
        async function testFilePath() {
            const path = document.getElementById('yamlPath').value;
            const resultDiv = document.getElementById('pathResult');
            
            try {
                const response = await fetch(path, { method: 'HEAD' });
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <span class="status success">âœ… æª”æ¡ˆè·¯å¾‘æ­£ç¢º</span>
                        <pre>ç‹€æ…‹ç¢¼: ${response.status}
æª”æ¡ˆé¡å‹: ${response.headers.get('content-type') || 'Unknown'}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <span class="status error">âŒ æª”æ¡ˆä¸å­˜åœ¨</span>
                        <pre>ç‹€æ…‹ç¢¼: ${response.status}
éŒ¯èª¤: ${response.statusText}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="status error">âŒ ç¶²è·¯éŒ¯èª¤</span>
                    <pre>éŒ¯èª¤è¨Šæ¯: ${error.message}
å¯èƒ½åŸå› : 
1. æª”æ¡ˆè·¯å¾‘ä¸æ­£ç¢º
2. æœ¬åœ°æª”æ¡ˆç³»çµ±é™åˆ¶ (CORS)
3. ä¼ºæœå™¨æœªé‹è¡Œ</pre>
                `;
            }
        }

        // æ¸¬è©¦ç¶²è·¯è«‹æ±‚
        async function testNetworkRequest() {
            const path = document.getElementById('yamlPath').value;
            const resultDiv = document.getElementById('networkResult');
            
            try {
                const response = await fetch(path);
                const text = await response.text();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <span class="status success">âœ… ç¶²è·¯è«‹æ±‚æˆåŠŸ</span>
                        <pre>æª”æ¡ˆå¤§å°: ${text.length} å­—ç¬¦
å‰ 200 å­—ç¬¦: 
${text.substring(0, 200)}...</pre>
                    `;
                    yamlContent = text;
                } else {
                    resultDiv.innerHTML = `
                        <span class="status error">âŒ è«‹æ±‚å¤±æ•—</span>
                        <pre>ç‹€æ…‹: ${response.status} ${response.statusText}
éŸ¿æ‡‰å…§å®¹: ${text}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="status error">âŒ è«‹æ±‚ç•°å¸¸</span>
                    <pre>${error.message}</pre>
                `;
            }
        }

        // è¼‰å…¥ä¸¦é¡¯ç¤º YAML
        async function loadAndShowYaml() {
            const path = document.getElementById('yamlPath').value;
            const previewDiv = document.getElementById('yamlPreview');
            
            try {
                const response = await fetch(path);
                const text = await response.text();
                yamlContent = text;
                
                previewDiv.innerHTML = `
                    <span class="status info">ğŸ“„ YAML å…§å®¹</span>
                    <pre>${text}</pre>
                `;
            } catch (error) {
                previewDiv.innerHTML = `
                    <span class="status error">âŒ ç„¡æ³•è¼‰å…¥æª”æ¡ˆ</span>
                    <pre>${error.message}</pre>
                `;
            }
        }

        // æ¸¬è©¦ YAML è§£æ
        function testYamlParsing() {
            const resultDiv = document.getElementById('parseResult');
            
            if (!yamlContent) {
                resultDiv.innerHTML = `
                    <span class="status warning">âš ï¸ è«‹å…ˆè¼‰å…¥ YAML å…§å®¹</span>
                `;
                return;
            }

            if (typeof jsyaml === 'undefined') {
                resultDiv.innerHTML = `
                    <span class="status error">âŒ js-yaml åº«æœªè¼‰å…¥</span>
                `;
                return;
            }

            try {
                const parsed = jsyaml.load(yamlContent);
                resultDiv.innerHTML = `
                    <span class="status success">âœ… YAML è§£ææˆåŠŸ</span>
                    <pre>è§£æçµæœ:
${JSON.stringify(parsed, null, 2)}</pre>
                `;
                
                // ç”Ÿæˆå»ºè­°
                generateSuggestions(parsed);
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="status error">âŒ YAML è§£æå¤±æ•—</span>
                    <pre>éŒ¯èª¤è¨Šæ¯: ${error.message}
éŒ¯èª¤è¡Œè™Ÿ: ${error.mark ? error.mark.line + 1 : 'Unknown'}
éŒ¯èª¤åˆ—è™Ÿ: ${error.mark ? error.mark.column + 1 : 'Unknown'}</pre>
                `;
            }
        }

        // ç”Ÿæˆä¿®å¾©å»ºè­°
        function generateSuggestions(parsedData) {
            const suggestionsDiv = document.getElementById('suggestions');
            const suggestions = [];

            if (!parsedData) {
                suggestions.push('âŒ YAML æª”æ¡ˆç‚ºç©ºæˆ–è§£æå¤±æ•—');
            } else {
                if (!parsedData.organizations) {
                    suggestions.push('âŒ ç¼ºå°‘ "organizations" é™£åˆ—');
                } else if (!Array.isArray(parsedData.organizations)) {
                    suggestions.push('âŒ "organizations" æ‡‰è©²æ˜¯é™£åˆ—æ ¼å¼');
                } else if (parsedData.organizations.length === 0) {
                    suggestions.push('âš ï¸ "organizations" é™£åˆ—ç‚ºç©º');
                } else {
                    suggestions.push(`âœ… æ‰¾åˆ° ${parsedData.organizations.length} å€‹çµ„ç¹”`);
                    
                    // æª¢æŸ¥æ¯å€‹çµ„ç¹”çš„å¿…å¡«æ¬„ä½
                    parsedData.organizations.forEach((org, index) => {
                        const required = ['id', 'title', 'subtitle', 'description', 'status'];
                        const missing = required.filter(field => !org[field]);
                        if (missing.length > 0) {
                            suggestions.push(`âŒ çµ„ç¹” ${index + 1} ç¼ºå°‘å¿…å¡«æ¬„ä½: ${missing.join(', ')}`);
                        }
                    });
                }

                if (!parsedData.status_config) {
                    suggestions.push('âš ï¸ å»ºè­°æ·»åŠ  "status_config" é…ç½®');
                }

                if (!parsedData.page_config) {
                    suggestions.push('âš ï¸ å»ºè­°æ·»åŠ  "page_config" é…ç½®');
                }
            }

            // é€šç”¨å»ºè­°
            suggestions.push('');
            suggestions.push('ğŸ”§ å¸¸è¦‹è§£æ±ºæ–¹æ¡ˆ:');
            suggestions.push('1. ç¢ºä¿ YAML æª”æ¡ˆç¸®æ’æ­£ç¢º (ä½¿ç”¨ç©ºæ ¼ï¼Œä¸è¦ç”¨ Tab)');
            suggestions.push('2. æª¢æŸ¥æª”æ¡ˆç·¨ç¢¼æ˜¯å¦ç‚º UTF-8');
            suggestions.push('3. ç¢ºä¿å­—ä¸²å€¼ä½¿ç”¨å¼•è™ŸåŒ…åœ');
            suggestions.push('4. æª¢æŸ¥ç‰¹æ®Šå­—ç¬¦æ˜¯å¦æ­£ç¢ºè½‰ç¾©');
            suggestions.push('5. ä½¿ç”¨æœ¬åœ°ä¼ºæœå™¨æ¸¬è©¦ (å¦‚ Live Server)');

            suggestionsDiv.innerHTML = `<pre>${suggestions.join('\n')}</pre>`;
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.onload = function() {
            checkJsYaml();
            
            // æª¢æŸ¥æ˜¯å¦åœ¨æœ¬åœ°æª”æ¡ˆç³»çµ±
            if (window.location.protocol === 'file:') {
                document.body.insertAdjacentHTML('afterbegin', `
                    <div class="debug-section">
                        <span class="status warning">âš ï¸ æ³¨æ„ï¼šæ‚¨æ­£åœ¨ä½¿ç”¨ file:// å”è­°</span>
                        <p>å»ºè­°ä½¿ç”¨æœ¬åœ°ä¼ºæœå™¨ (å¦‚ Live Server, Python http.server ç­‰) ä¾†æ¸¬è©¦ YAML è¼‰å…¥åŠŸèƒ½</p>
                    </div>
                `);
            }
        };
    </script>
</body>
</html>